<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon" href="img/icon.png" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="css/voting.css" />
  <title>Voting System</title>
</head>

<body>
  <div class="container py-4">
    <h1 class="text-center mb-4">ELECOM Voting System</h1><img src="img/icon.png" alt="use data to see photo" class="img-logo">

    <!-- Role selection -->
<div id="roleSelectionForm">
  <button onclick="selectRole('student')">Student</button>
  <button onclick="selectRole('comelec')">COMELEC</button>
</div>

<!-- Login form -->
<div id="loginForm" class="d-none">
  <input type="text" id="id" placeholder="ID">
  <input type="password" id="password" placeholder="Password">

  <div id="departmentContainer">
    <select id="department">
      <option value="">--Select Department--</option>
      <option value="BSIT">BSIT</option>
      <option value="BTLED">BTLED</option>
      <option value="BFPT">BFPT</option>
    </select>
  </div>

  <button onclick="login()">Login</button>
</div>


   <!-- Student Section -->
<div id="studentSection" class="d-none">
  <h2>Welcome, Student</h2>
  <div id="deptCandidates"></div>
  <div id="usgCandidates"></div>
  <div class="text-center mt-4">
    <button onclick="logout()" class="btn btn-danger">Logout</button>
    <button onclick="showChangePasswordForm()" class="btn btn-warning ms-2">Change Password</button>
  </div>
</div>

<!-- COMELEC Section -->
<div id="comelecSection" class="d-none">
  <h2>ELECOM Officer Panel</h2>
  <div class="row g-2 mb-3">
    <div class="col-md-4">
      <input type="text" id="newCandidate" class="form-control" placeholder="Candidate Name" />
    </div>
    <div class="col-md-4">
      <select id="candidateDept" class="form-select" onchange="updatePositions()">
        <option value="USG">USG</option>
        <option value="IT">IT</option>
        <option value="Food Processing">Food Processing</option>
        <option value="Education">Education</option>
      </select>
    </div>
    <div class="col-md-4">
      <select id="candidatePosition" class="form-select">
        <option value="President">President</option>
        <option value="Vice President">Vice President</option>
        <option value="GenSec">GenSec</option>
        <option value="AssSec">AssSec</option>
        <option value="Treasurer">Treasurer</option>
        <option value="Auditor">Auditor</option>
        <option value="PIO">PIO</option>
        <option value="BTLED Rep" class="rep-option">BTLED Rep</option>
        <option value="BSIT Rep" class="rep-option">BSIT Rep</option>
        <option value="BFPT Rep" class="rep-option">BFPT Rep</option>
      </select>
    </div>
  </div>
  <button onclick="addCandidate()" class="btn btn-success mb-4">Add Candidate</button>

  <h3>All Candidates</h3>
  <div id="allCandidates" class="mb-3"></div>

  <h3>All Votes</h3>
  <pre id="results"></pre>

  <div class="text-center mt-4">
    <button onclick="logout()" class="btn btn-danger">Logout</button>
    <button onclick="showChangePasswordForm()" class="btn btn-warning ms-2">Change Password</button>
  </div>
</div>

<!-- Password Change Form -->
<div id="changePasswordForm" class="d-none">
  <h3>Change Password</h3>
  <input type="password" id="currentPassword" class="form-control mb-2" placeholder="Current Password" />
  <input type="password" id="newPassword" class="form-control mb-2" placeholder="New Password" />
  <input type="password" id="confirmPassword" class="form-control mb-2" placeholder="Confirm New Password" />
  <button onclick="changePassword()" class="btn btn-success mb-3">Change Password</button>
  <button onclick="cancelPasswordChange()" class="btn btn-secondary">Cancel</button>
</div>


  <script src="function/voting.js"></script>
  
  <script>
    // Show the change password form
function showChangePasswordForm() {
  document.getElementById('changePasswordForm').classList.remove('d-none');
  document.getElementById('studentSection').classList.add('d-none');
  document.getElementById('comelecSection').classList.add('d-none');
}

// Cancel the password change and go back to user's section
function cancelPasswordChange() {
  document.getElementById('changePasswordForm').classList.add('d-none');
  
  if (currentUser && currentUser.role === 'student') {
    document.getElementById('studentSection').classList.remove('d-none');
  } else if (currentUser && currentUser.role === 'comelec') {
    document.getElementById('comelecSection').classList.remove('d-none');
  }
}

// Handle changing the password for the current logged-in user only-------------------
function changePassword() {
  const currentPassword = document.getElementById('currentPassword').value.trim();
  const newPassword = document.getElementById('newPassword').value.trim();
  const confirmPassword = document.getElementById('confirmPassword').value.trim();

  if (!currentUser || !currentUser.username) {
    alert("No user is currently logged in.");
    return;
  }

  const userData = JSON.parse(localStorage.getItem(currentUser.username));

  if (!userData || !userData.password) {
    alert("No password found for this user.");
    return;
  }

  if (currentPassword !== userData.password) {
    alert("Current password is incorrect.");
    return;
  }

  if (newPassword !== confirmPassword) {
    alert("New passwords do not match.");
    return;
  }

  // Update password
  userData.password = newPassword;
  localStorage.setItem(currentUser.username, JSON.stringify(userData));
  currentUser.password = newPassword;

  alert("Password changed successfully!");

  // Hide form and show section
  document.getElementById('changePasswordForm').classList.add('d-none');

  if (currentUser.role === 'student') {
    document.getElementById('studentSection').classList.remove('d-none');
    showStudentVoting();
  } else {
    document.getElementById('comelecSection').classList.remove('d-none');
    showAllCandidates();
    showResults();
  }
}
//----------------------------------------------------------------------------------


//User------------------------------------------------------------------------------
const user = {
  username: "20231234",
  password: "1234",
  role: "student", // or "comelec"
  department: "BSIT"
};
localStorage.setItem(user.username, JSON.stringify(user));
//-----------------------------------------------------------------------------------
  </script>
</body>
</html>
